@model ChronosMVC.Models.PublicacaoModel
@{
    ViewBag.Title = "Detalhes da Publicação";
}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>

<body>
    <div class="container mt-5">
        <h2>@Model.títuloPublicacao</h2>
        <p>@Model.conteudoPublicacao</p>
        <p class="text-muted">Avaliação: @Model.avaliacaoPublicacao</p>

        @if (Model.imagemPublicacao != null)
        {
            <img src="data:image/png;base64,@Convert.ToBase64String(Model.imagemPublicacao)" alt="Imagem da publicação" class="img-fluid my-3" />
        }
        else
        {
            <p class="text-muted">Nenhuma imagem disponível.</p>
        }

        <div class="d-flex justify-content-around mt-3">
            <button class="btn btn-outline-secondary" aria-label="Curtir publicação">
                <i class="bi bi-heart"></i> Curtir
            </button>
            <a href="#comentarioSection" class="btn btn-info">Adicionar Comentário</a>
            <button class="btn btn-outline-secondary" aria-label="Ver visualizações da publicação">
                <i class="bi bi-eye"></i> Visualizações
            </button>
        </div>

        <h3 class="mt-4">Comentários</h3>
        <div id="comentariosList">
            @if (Model.Comentarios != null && Model.Comentarios.Any())
            {
                foreach (var comentario in Model.Comentarios)
                {
                    <div class="border-bottom mb-2 pb-2">
                        <p>@comentario.comentarioPublicacao</p>
                    </div>
                }
            }
            else
            {
                <p>Nenhum comentário disponível.</p>
            }
        </div>

        <h3 class="mt-4" id="comentarioSection">Adicionar Comentário</h3>
        <!-- Formulário que chama o método Create do ComentarioController -->
        <form asp-action="Create" asp-controller="Comentario" method="post">
            <input type="hidden" name="idPublicacao" value="@Model.idPublicacao" />
            <input type="hidden" name="idEgresso" value="@ViewBag.IdEgresso" /> <!-- Campo oculto para idEgresso -->
            <div class="mb-3">
                <label for="comentarioPublicacao" class="form-label">Comentário</label>
                <textarea name="comentarioPublicacao" class="form-control" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Salvar</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
